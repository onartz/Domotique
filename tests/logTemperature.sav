import serial
from tempodb import Client
from datetime import datetime
import urllib2, requests
import json
print datetime.now()
#client TempoDB
tempoDbClient=Client("7893765c91314ba5864feafcc41a12f2","6d8dddfc032d4482996d7398019d687e")

res=''
ser = serial.Serial('/dev/ttyUSB0', 57600, timeout=1)
def ByteToHex( byteStr ):
   if byteStr is '':
	return 'vide'
   else:
   	return ''.join( [ "%02X " % ord( x ) for x in byteStr ] ).strip()
   #return byteStr[9]
while True:
    res = ser.read(100)
    if len(res) > 9 : 
        temp = 40-0.1548627*ord(res[9])-2
	data=[{'key': 'TEMP1', 'v':temp}]
	tempoDbClient.write_bulk(datetime.now(),data)

#    res = ByteToHex(ser.read(100))
#    if res != 'vide' :
#       print res.split( )
#    if res==ByteToHex(ser.read(100)) is not 'vide':
#	print('recu : ',res)
